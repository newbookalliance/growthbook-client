{"version":3,"file":"GrowthBook.js","names":["isBrowser","window","document","base64ToBuf","b","Uint8Array","from","atob","c","charCodeAt","GrowthBook","constructor","context","_ctx","_renderer","_trackedExperiments","Set","_trackedFeatures","debug","_subscriptions","_rtQueue","_rtTimer","ready","_assigned","Map","_forcedFeatureValues","_attributeOverrides","features","enableDevMode","_growthbook","dispatchEvent","Event","clientKey","_refresh","loadFeatures","options","autoRefresh","subscribe","refreshFeatures","getApiInfo","apiHost","replace","allowStale","updateInstance","Error","timeout","skipCache","_render","setFeatures","setEncryptedFeatures","encryptedString","decryptionKey","subtle","globalThis","crypto","key","importKey","name","length","iv","cipherText","split","plainTextBuffer","decrypt","JSON","parse","TextDecoder","decode","e","setAttributes","attributes","setAttributeOverrides","overrides","setForcedVariations","vars","forcedVariations","setForcedFeatures","map","getAttributes","getFeatures","cb","add","delete","getAllResults","destroy","clear","clearTimeout","unsubscribe","setRenderer","renderer","forceVariation","variation","run","experiment","result","_run","_fireSubscriptions","prev","get","inExperiment","variationId","set","forEach","console","error","_trackFeatureUsage","res","source","stringifiedValue","stringify","value","onFeatureUsage","fetch","push","on","setTimeout","q","realtimeKey","encodeURIComponent","cache","mode","catch","realtimeInterval","_getFeatureResult","ruleId","ret","off","experimentResult","isOn","evalFeature","isOff","getFeatureValue","defaultValue","feature","id","has","process","env","NODE_ENV","log","rules","rule","condition","_conditionPasses","hashValue","_getHashAttribute","hashAttribute","n","hash","coverage","force","variations","exp","weights","namespace","evalCondition","featureId","numVariations","_getResult","enabled","_mergeOverrides","qsOverride","getQueryStringOverride","_getContextUrl","status","active","inNamespace","include","isIncluded","groups","_hasGroupOverlap","url","_urlIsValid","ranges","getBucketRanges","assigned","chooseVariation","qaMode","_track","msg","ctx","trackingCallback","k","o","Object","assign","getUrlRegExp","attr","user","variationIndex","hashUsed","location","href","urlRegex","pathOnly","test","expGroups","i"],"sources":["../../src/GrowthBook.ts"],"sourcesContent":["import type {\n  Context,\n  Experiment,\n  FeatureResult,\n  Result,\n  SubscriptionFunction,\n  FeatureDefinition,\n  FeatureResultSource,\n  Attributes,\n  JSONValue,\n  WidenPrimitives,\n  RealtimeUsageData,\n  LoadFeaturesOptions,\n  RefreshFeaturesOptions,\n  ApiHost,\n  ClientKey,\n} from \"./types/growthbook\";\nimport type { ConditionInterface } from \"./types/mongrule\";\nimport {\n  getUrlRegExp,\n  isIncluded,\n  getBucketRanges,\n  hash,\n  chooseVariation,\n  getQueryStringOverride,\n  inNamespace,\n} from \"./util\";\nimport { evalCondition } from \"./mongrule\";\nimport { refreshFeatures, subscribe, unsubscribe } from \"./feature-repository\";\n\nconst isBrowser =\n  typeof window !== \"undefined\" && typeof document !== \"undefined\";\n\nconst base64ToBuf = (b: string) =>\n  Uint8Array.from(atob(b), (c) => c.charCodeAt(0));\n\nexport class GrowthBook {\n  // context is technically private, but some tools depend on it so we can't mangle the name\n  // _ctx below is a clone of this property that we use internally\n  private context: Context;\n  public debug: boolean;\n  public ready: boolean;\n\n  // Properties and methods that start with \"_\" are mangled by Terser (saves ~150 bytes)\n  private _ctx: Context;\n  private _renderer: null | (() => void);\n  private _trackedExperiments: Set<unknown>;\n  private _trackedFeatures: Record<string, string>;\n  private _subscriptions: Set<SubscriptionFunction>;\n  private _rtQueue: RealtimeUsageData[];\n  private _rtTimer: number;\n  private _assigned: Map<\n    string,\n    {\n      // eslint-disable-next-line\n      experiment: Experiment<any>;\n      // eslint-disable-next-line\n      result: Result<any>;\n    }\n  >;\n  // eslint-disable-next-line\n  private _forcedFeatureValues: Map<string, any>;\n  private _attributeOverrides: Attributes;\n\n  constructor(context?: Context) {\n    context = context || {};\n    // These properties are all initialized in the constructor instead of above\n    // This saves ~80 bytes in the final output\n    this._ctx = this.context = context;\n    this._renderer = null;\n    this._trackedExperiments = new Set();\n    this._trackedFeatures = {};\n    this.debug = false;\n    this._subscriptions = new Set();\n    this._rtQueue = [];\n    this._rtTimer = 0;\n    this.ready = false;\n    this._assigned = new Map();\n    this._forcedFeatureValues = new Map();\n    this._attributeOverrides = {};\n\n    if (context.features) {\n      this.ready = true;\n    }\n\n    if (isBrowser && context.enableDevMode) {\n      window._growthbook = this;\n      document.dispatchEvent(new Event(\"gbloaded\"));\n    }\n\n    if (context.clientKey) {\n      this._refresh({}, true, false);\n    }\n  }\n\n  public async loadFeatures(options?: LoadFeaturesOptions): Promise<void> {\n    await this._refresh(options, true, true);\n    if (options && options.autoRefresh) {\n      subscribe(this);\n    }\n  }\n\n  public async refreshFeatures(\n    options?: RefreshFeaturesOptions\n  ): Promise<void> {\n    await this._refresh(options, false, true);\n  }\n\n  public getApiInfo(): [ApiHost, ClientKey] {\n    return [\n      (this._ctx.apiHost || \"https://cdn.growthbook.io\").replace(/\\/*$/, \"\"),\n      this._ctx.clientKey || \"\",\n    ];\n  }\n\n  private async _refresh(\n    options?: RefreshFeaturesOptions,\n    allowStale?: boolean,\n    updateInstance?: boolean\n  ) {\n    options = options || {};\n    if (!this._ctx.clientKey) {\n      throw new Error(\"Missing clientKey\");\n    }\n    await refreshFeatures(\n      this,\n      options.timeout,\n      options.skipCache || this._ctx.enableDevMode,\n      allowStale,\n      updateInstance\n    );\n  }\n\n  private _render() {\n    if (this._renderer) {\n      this._renderer();\n    }\n  }\n\n  public setFeatures(features: Record<string, FeatureDefinition>) {\n    this._ctx.features = features;\n    this.ready = true;\n    this._render();\n  }\n\n  public async setEncryptedFeatures(\n    encryptedString: string,\n    decryptionKey?: string,\n    subtle?: SubtleCrypto\n  ): Promise<void> {\n    decryptionKey = decryptionKey || this._ctx.decryptionKey || \"\";\n    subtle = subtle || (globalThis.crypto && globalThis.crypto.subtle);\n    if (!subtle) {\n      throw new Error(\"No SubtleCrypto implementation found\");\n    }\n    try {\n      const key = await subtle.importKey(\n        \"raw\",\n        base64ToBuf(decryptionKey),\n        { name: \"AES-CBC\", length: 128 },\n        true,\n        [\"encrypt\", \"decrypt\"]\n      );\n      const [iv, cipherText] = encryptedString.split(\".\");\n      const plainTextBuffer = await subtle.decrypt(\n        { name: \"AES-CBC\", iv: base64ToBuf(iv) },\n        key,\n        base64ToBuf(cipherText)\n      );\n\n      this.setFeatures(JSON.parse(new TextDecoder().decode(plainTextBuffer)));\n    } catch (e) {\n      throw new Error(\"Failed to decrypt features\");\n    }\n  }\n\n  public setAttributes(attributes: Attributes) {\n    this._ctx.attributes = attributes;\n    this._render();\n  }\n\n  public setAttributeOverrides(overrides: Attributes) {\n    this._attributeOverrides = overrides;\n    this._render();\n  }\n  public setForcedVariations(vars: Record<string, number>) {\n    this._ctx.forcedVariations = vars || {};\n    this._render();\n  }\n  // eslint-disable-next-line\n  public setForcedFeatures(map: Map<string, any>) {\n    this._forcedFeatureValues = map;\n    this._render();\n  }\n\n  public getAttributes() {\n    return { ...this._ctx.attributes, ...this._attributeOverrides };\n  }\n\n  public getFeatures() {\n    return this._ctx.features || {};\n  }\n\n  public subscribe(cb: SubscriptionFunction): () => void {\n    this._subscriptions.add(cb);\n\n    return () => {\n      this._subscriptions.delete(cb);\n    };\n  }\n\n  public getAllResults() {\n    return new Map(this._assigned);\n  }\n\n  public destroy() {\n    // Release references to save memory\n    this._subscriptions.clear();\n    this._assigned.clear();\n    this._trackedExperiments.clear();\n    this._trackedFeatures = {};\n    this._rtQueue = [];\n    if (this._rtTimer) {\n      clearTimeout(this._rtTimer);\n    }\n    unsubscribe(this);\n\n    if (isBrowser && window._growthbook === this) {\n      delete window._growthbook;\n    }\n  }\n\n  public setRenderer(renderer: () => void) {\n    this._renderer = renderer;\n  }\n\n  public forceVariation(key: string, variation: number) {\n    this._ctx.forcedVariations = this._ctx.forcedVariations || {};\n    this._ctx.forcedVariations[key] = variation;\n    this._render();\n  }\n\n  public run<T>(experiment: Experiment<T>): Result<T> {\n    const result = this._run(experiment, null);\n    this._fireSubscriptions(experiment, result);\n    return result;\n  }\n\n  private _fireSubscriptions<T>(experiment: Experiment<T>, result: Result<T>) {\n    const key = experiment.key;\n\n    // If assigned variation has changed, fire subscriptions\n    const prev = this._assigned.get(key);\n    // TODO: what if the experiment definition has changed?\n    if (\n      !prev ||\n      prev.result.inExperiment !== result.inExperiment ||\n      prev.result.variationId !== result.variationId\n    ) {\n      this._assigned.set(key, { experiment, result });\n      this._subscriptions.forEach((cb) => {\n        try {\n          cb(experiment, result);\n        } catch (e) {\n          console.error(e);\n        }\n      });\n    }\n  }\n\n  private _trackFeatureUsage(key: string, res: FeatureResult): void {\n    // Don't track feature usage that was forced via an override\n    if (res.source === \"override\") return;\n\n    // Only track a feature once, unless the assigned value changed\n    const stringifiedValue = JSON.stringify(res.value);\n    if (this._trackedFeatures[key] === stringifiedValue) return;\n    this._trackedFeatures[key] = stringifiedValue;\n\n    // Fire user-supplied callback\n    if (this._ctx.onFeatureUsage) {\n      try {\n        this._ctx.onFeatureUsage(key, res);\n      } catch (e) {\n        // Ignore feature usage callback errors\n      }\n    }\n\n    // In browser environments, queue up feature usage to be tracked in batches\n    if (!isBrowser || !window.fetch) return;\n    this._rtQueue.push({\n      key,\n      on: res.on,\n    });\n    if (!this._rtTimer) {\n      this._rtTimer = window.setTimeout(() => {\n        // Reset the queue\n        this._rtTimer = 0;\n        const q = [...this._rtQueue];\n        this._rtQueue = [];\n\n        // Skip logging if a real-time usage key is not configured\n        if (!this._ctx.realtimeKey) return;\n\n        window\n          .fetch(\n            `https://rt.growthbook.io/?key=${\n              this._ctx.realtimeKey\n            }&events=${encodeURIComponent(JSON.stringify(q))}`,\n\n            {\n              cache: \"no-cache\",\n              mode: \"no-cors\",\n            }\n          )\n          .catch(() => {\n            // TODO: retry in case of network errors?\n          });\n      }, this._ctx.realtimeInterval || 2000);\n    }\n  }\n\n  private _getFeatureResult<T>(\n    key: string,\n    value: T,\n    source: FeatureResultSource,\n    ruleId?: string,\n    experiment?: Experiment<T>,\n    result?: Result<T>\n  ): FeatureResult<T> {\n    const ret: FeatureResult = {\n      value,\n      on: !!value,\n      off: !value,\n      source,\n      ruleId: ruleId || \"\",\n    };\n    if (experiment) ret.experiment = experiment;\n    if (result) ret.experimentResult = result;\n\n    // Track the usage of this feature in real-time\n    this._trackFeatureUsage(key, ret);\n\n    return ret;\n  }\n\n  public isOn(key: string): boolean {\n    return this.evalFeature(key).on;\n  }\n  public isOff(key: string): boolean {\n    return this.evalFeature(key).off;\n  }\n  public getFeatureValue<T extends JSONValue>(\n    key: string,\n    defaultValue: T\n  ): WidenPrimitives<T> {\n    return (\n      this.evalFeature<WidenPrimitives<T>>(key).value ??\n      (defaultValue as WidenPrimitives<T>)\n    );\n  }\n\n  // eslint-disable-next-line\n  public feature<T extends JSONValue = any>(\n    id: string\n  ): FeatureResult<T | null> {\n    return this.evalFeature(id);\n  }\n\n  // eslint-disable-next-line\n  public evalFeature<T extends JSONValue = any>(\n    id: string\n  ): FeatureResult<T | null> {\n    // Global override\n    if (this._forcedFeatureValues.has(id)) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Global override\", {\n          id,\n          value: this._forcedFeatureValues.get(id),\n        });\n      return this._getFeatureResult(\n        id,\n        this._forcedFeatureValues.get(id),\n        \"override\"\n      );\n    }\n\n    // Unknown feature id\n    if (!this._ctx.features || !this._ctx.features[id]) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Unknown feature\", { id });\n      return this._getFeatureResult(id, null, \"unknownFeature\");\n    }\n\n    // Get the feature\n    const feature: FeatureDefinition<T> = this._ctx.features[id];\n\n    // Loop through the rules\n    if (feature.rules) {\n      for (const rule of feature.rules) {\n        // If it's a conditional rule, skip if the condition doesn't pass\n        if (rule.condition && !this._conditionPasses(rule.condition)) {\n          process.env.NODE_ENV !== \"production\" &&\n            this.log(\"Skip rule because of condition\", {\n              id,\n              rule,\n            });\n          continue;\n        }\n        // Feature value is being forced\n        if (\"force\" in rule) {\n          // Skip if coverage is reduced and user not included\n          if (\"coverage\" in rule) {\n            const { hashValue } = this._getHashAttribute(rule.hashAttribute);\n            if (!hashValue) {\n              process.env.NODE_ENV !== \"production\" &&\n                this.log(\"Skip rule because of missing hashAttribute\", {\n                  id,\n                  rule,\n                });\n              continue;\n            }\n            const n = hash(hashValue + id);\n            if (n > (rule.coverage as number)) {\n              process.env.NODE_ENV !== \"production\" &&\n                this.log(\"Skip rule because of coverage\", {\n                  id,\n                  rule,\n                });\n              continue;\n            }\n          }\n\n          process.env.NODE_ENV !== \"production\" &&\n            this.log(\"Force value from rule\", {\n              id,\n              rule,\n            });\n\n          return this._getFeatureResult(id, rule.force as T, \"force\", rule.id);\n        }\n        if (!rule.variations) {\n          process.env.NODE_ENV !== \"production\" &&\n            this.log(\"Skip invalid rule\", {\n              id,\n              rule,\n            });\n\n          continue;\n        }\n        // For experiment rules, run an experiment\n        const exp: Experiment<T> = {\n          variations: rule.variations as [T, T, ...T[]],\n          key: rule.key || id,\n        };\n        if (\"coverage\" in rule) exp.coverage = rule.coverage;\n        if (rule.weights) exp.weights = rule.weights;\n        if (rule.hashAttribute) exp.hashAttribute = rule.hashAttribute;\n        if (rule.namespace) exp.namespace = rule.namespace;\n\n        // Only return a value if the user is part of the experiment\n        const res = this._run(exp, id);\n        this._fireSubscriptions(exp, res);\n        if (res.inExperiment) {\n          return this._getFeatureResult(\n            id,\n            res.value,\n            \"experiment\",\n            rule.id,\n            exp,\n            res\n          );\n        }\n      }\n    }\n\n    process.env.NODE_ENV !== \"production\" &&\n      this.log(\"Use default value\", {\n        id,\n        value: feature.defaultValue ?? null,\n      });\n\n    // Fall back to using the default value\n    return this._getFeatureResult(\n      id,\n      feature.defaultValue ?? null,\n      \"defaultValue\"\n    );\n  }\n\n  private _conditionPasses(condition: ConditionInterface): boolean {\n    return evalCondition(this.getAttributes(), condition);\n  }\n\n  private _run<T>(\n    experiment: Experiment<T>,\n    featureId: string | null\n  ): Result<T> {\n    const key = experiment.key;\n    const numVariations = experiment.variations.length;\n\n    // 1. If experiment has less than 2 variations, return immediately\n    if (numVariations < 2) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Invalid experiment\", { id: key });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 2. If the context is disabled, return immediately\n    if (this._ctx.enabled === false) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Context disabled\", { id: key });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 2.5. Merge in experiment overrides from the context\n    experiment = this._mergeOverrides(experiment);\n\n    // 3. If a variation is forced from a querystring, return the forced variation\n    const qsOverride = getQueryStringOverride(\n      key,\n      this._getContextUrl(),\n      numVariations\n    );\n    if (qsOverride !== null) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Force via querystring\", {\n          id: key,\n          variation: qsOverride,\n        });\n      return this._getResult(experiment, qsOverride, false, featureId);\n    }\n\n    // 4. If a variation is forced in the context, return the forced variation\n    if (this._ctx.forcedVariations && key in this._ctx.forcedVariations) {\n      const variation = this._ctx.forcedVariations[key];\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Force via dev tools\", {\n          id: key,\n          variation,\n        });\n      return this._getResult(experiment, variation, false, featureId);\n    }\n\n    // 5. Exclude if a draft experiment or not active\n    if (experiment.status === \"draft\" || experiment.active === false) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because inactive\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 6. Get the hash attribute and return if empty\n    const { hashValue } = this._getHashAttribute(experiment.hashAttribute);\n    if (!hashValue) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because missing hashAttribute\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 7. Exclude if user not in experiment.namespace\n    if (experiment.namespace && !inNamespace(hashValue, experiment.namespace)) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because of namespace\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 7.5. Exclude if experiment.include returns false or throws\n    if (experiment.include && !isIncluded(experiment.include)) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because of include function\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 8. Exclude if condition is false\n    if (experiment.condition && !this._conditionPasses(experiment.condition)) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because of condition\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 8.1. Exclude if user is not in a required group\n    if (\n      experiment.groups &&\n      !this._hasGroupOverlap(experiment.groups as string[])\n    ) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because of groups\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 8.2. Exclude if not on a targeted url\n    if (experiment.url && !this._urlIsValid(experiment.url as RegExp)) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because of url\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 9. Get bucket ranges and choose variation\n    const ranges = getBucketRanges(\n      numVariations,\n      experiment.coverage ?? 1,\n      experiment.weights\n    );\n    const n = hash(hashValue + key);\n    const assigned = chooseVariation(n, ranges);\n\n    // 10. Return if not in experiment\n    if (assigned < 0) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because of coverage\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 11. Experiment has a forced variation\n    if (\"force\" in experiment) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Force variation\", {\n          id: key,\n          variation: experiment.force,\n        });\n      return this._getResult(\n        experiment,\n        experiment.force ?? -1,\n        false,\n        featureId\n      );\n    }\n\n    // 12. Exclude if in QA mode\n    if (this._ctx.qaMode) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because QA mode\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 12.5. Exclude if experiment is stopped\n    if (experiment.status === \"stopped\") {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because stopped\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 13. Build the result object\n    const result = this._getResult(experiment, assigned, true, featureId);\n\n    // 14. Fire the tracking callback\n    this._track(experiment, result);\n\n    // 15. Return the result\n    process.env.NODE_ENV !== \"production\" &&\n      this.log(\"In experiment\", {\n        id: key,\n        variation: result.variationId,\n      });\n    return result;\n  }\n\n  log(msg: string, ctx: Record<string, unknown>) {\n    if (!this.debug) return;\n    if (this._ctx.log) this._ctx.log(msg, ctx);\n    else console.log(msg, ctx);\n  }\n\n  private _track<T>(experiment: Experiment<T>, result: Result<T>) {\n    if (!this._ctx.trackingCallback) return;\n\n    const key = experiment.key;\n\n    // Make sure a tracking callback is only fired once per unique experiment\n    const k =\n      result.hashAttribute + result.hashValue + key + result.variationId;\n    if (this._trackedExperiments.has(k)) return;\n    this._trackedExperiments.add(k);\n\n    try {\n      this._ctx.trackingCallback(experiment, result);\n    } catch (e) {\n      console.error(e);\n    }\n  }\n\n  private _mergeOverrides<T>(experiment: Experiment<T>): Experiment<T> {\n    const key = experiment.key;\n    const o = this._ctx.overrides;\n    if (o && o[key]) {\n      experiment = Object.assign({}, experiment, o[key]);\n      if (typeof experiment.url === \"string\") {\n        experiment.url = getUrlRegExp(\n          // eslint-disable-next-line\n          experiment.url as any\n        );\n      }\n    }\n\n    return experiment;\n  }\n\n  private _getHashAttribute(attr?: string) {\n    const hashAttribute = attr || \"id\";\n\n    let hashValue = \"\";\n    if (this._attributeOverrides[hashAttribute]) {\n      hashValue = this._attributeOverrides[hashAttribute];\n    } else if (this._ctx.attributes) {\n      hashValue = this._ctx.attributes[hashAttribute] || \"\";\n    } else if (this._ctx.user) {\n      hashValue = this._ctx.user[hashAttribute] || \"\";\n    }\n\n    return { hashAttribute, hashValue };\n  }\n\n  private _getResult<T>(\n    experiment: Experiment<T>,\n    variationIndex: number,\n    hashUsed: boolean,\n    featureId: string | null\n  ): Result<T> {\n    let inExperiment = true;\n    // If assigned variation is not valid, use the baseline and mark the user as not in the experiment\n    if (variationIndex < 0 || variationIndex >= experiment.variations.length) {\n      variationIndex = 0;\n      inExperiment = false;\n    }\n\n    const { hashAttribute, hashValue } = this._getHashAttribute(\n      experiment.hashAttribute\n    );\n\n    return {\n      featureId,\n      inExperiment,\n      hashUsed,\n      variationId: variationIndex,\n      value: experiment.variations[variationIndex],\n      hashAttribute,\n      hashValue,\n    };\n  }\n\n  private _getContextUrl() {\n    return this._ctx.url || (isBrowser ? window.location.href : \"\");\n  }\n\n  private _urlIsValid(urlRegex: RegExp): boolean {\n    const url = this._getContextUrl();\n    if (!url) return false;\n\n    const pathOnly = url.replace(/^https?:\\/\\//, \"\").replace(/^[^/]*\\//, \"/\");\n\n    if (urlRegex.test(url)) return true;\n    if (urlRegex.test(pathOnly)) return true;\n    return false;\n  }\n\n  private _hasGroupOverlap(expGroups: string[]): boolean {\n    const groups = this._ctx.groups || {};\n    for (let i = 0; i < expGroups.length; i++) {\n      if (groups[expGroups[i]]) return true;\n    }\n    return false;\n  }\n}\n"],"mappings":"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"}