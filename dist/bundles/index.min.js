var growthbook=function(t){"use strict";const e={staleTTL:6e4,cacheKey:"gbFeaturesCache",backgroundSync:!0},n={fetch:globalThis.fetch?globalThis.fetch.bind(globalThis):void 0,SubtleCrypto:globalThis.crypto?globalThis.crypto.subtle:void 0,EventSource:globalThis.EventSource};try{globalThis.localStorage&&(n.localStorage=globalThis.localStorage)}catch(t){}const r=new Map;let i=!1;const s=new Map,o=new Map,u=new Map,c=new Set;async function h(){try{if(!n.localStorage)return;await n.localStorage.setItem(e.cacheKey,JSON.stringify(Array.from(s.entries())))}catch(t){}}function a(t){const[e,n]=t.getApiInfo();return["".concat(e,"||").concat(n),e,n]}function f(t,n){const i=n.dateUpdated||"",o=new Date(Date.now()+e.staleTTL),u=s.get(t);if(u&&i&&u.version===i)return void(u.staleAt=o);s.set(t,{data:n,version:i,staleAt:o}),h();const c=r.get(t);c&&c.forEach((t=>l(t,n)))}async function l(t,e){await(e.encryptedFeatures?t.setEncryptedFeatures(e.encryptedFeatures,void 0,n.SubtleCrypto):t.setFeatures(e.features||t.getFeatures()))}async function d(t){const[e,r,i]=a(t),s=r+"/api/features/"+i;let u=o.get(e);return u||(u=n.fetch(s).then((t=>("enabled"===t.headers.get("x-sse-support")&&c.add(e),t.json()))).then((n=>(f(e,n),w(t),o.delete(e),n))).catch((t=>(o.delete(e),Promise.resolve({})))),o.set(e,u)),await u}function w(t){const[r,i,s]=a(t);if(e.backgroundSync&&c.has(r)&&n.EventSource){if(u.has(r))return;const t={src:new n.EventSource("".concat(i,"/sub/").concat(s)),cb:e=>{try{const n=JSON.parse(e.data);f(r,n),t.errors=0}catch(e){y(t,r)}},errors:0};u.set(r,t),t.src.addEventListener("features",t.cb),t.src.onerror=()=>{y(t,r)}}}function y(t,e){t.errors++,(t.errors>3||2===t.src.readyState)&&b(t,e)}function b(t,e){t.src.onerror=null,t.src.close(),u.delete(e)}function p(){c.clear(),u.forEach(b),r.clear()}function g(t){return function(t){let e=2166136261;const n=t.length;for(let r=0;r<n;r++)e^=t.charCodeAt(r),e+=(e<<1)+(e<<4)+(e<<7)+(e<<8)+(e<<24);return e>>>0}(t)%1e3/1e3}function v(t){return t<=0?[]:new Array(t).fill(1/t)}const $={};function A(t,e){if("$or"in e)return T(t,e.$or);if("$nor"in e)return!T(t,e.$nor);if("$and"in e)return function(t,e){for(let n=0;n<e.length;n++)if(!A(t,e[n]))return!1;return!0}(t,e.$and);if("$not"in e)return!A(t,e.$not);for(const[n,r]of Object.entries(e))if(!O(r,m(t,n)))return!1;return!0}function m(t,e){const n=e.split(".");let r=t;for(let t=0;t<n.length;t++){if(!r||"object"!=typeof r||!(n[t]in r))return null;r=r[n[t]]}return r}function O(t,e){if("string"==typeof t)return e+""===t;if("number"==typeof t)return 1*e===t;if("boolean"==typeof t)return!!e===t;if(Array.isArray(t)||!S(t))return JSON.stringify(e)===JSON.stringify(t);for(const n in t)if(!_(n,e,t[n]))return!1;return!0}function S(t){const e=Object.keys(t);return e.length>0&&e.filter((t=>"$"===t[0])).length===e.length}function _(t,e,n){switch(t){case"$eq":return e===n;case"$ne":return e!==n;case"$lt":return e<n;case"$lte":return e<=n;case"$gt":return e>n;case"$gte":return e>=n;case"$exists":return n?null!==e:null===e;case"$in":return n.includes(e);case"$nin":return!n.includes(e);case"$not":return!O(n,e);case"$size":return!!Array.isArray(e)&&O(n,e.length);case"$elemMatch":return function(t,e){if(!Array.isArray(t))return!1;const n=S(e)?t=>O(e,t):t=>A(t,e);for(let e=0;e<t.length;e++)if(t[e]&&n(t[e]))return!0;return!1}(e,n);case"$all":if(!Array.isArray(e))return!1;for(let t=0;t<n.length;t++){let r=!1;for(let i=0;i<e.length;i++)if(O(n[t],e[i])){r=!0;break}if(!r)return!1}return!0;case"$regex":try{return(r=n,$[r]||($[r]=new RegExp(r.replace(/([^\\])\//g,"$1\\/"))),$[r]).test(e)}catch(t){return!1}case"$type":return function(t){if(null===t)return"null";if(Array.isArray(t))return"array";const e=typeof t;return["string","number","boolean","object","undefined"].includes(e)?e:"unknown"}(e)===n;default:return console.error("Unknown operator: "+t),!1}var r}function T(t,e){if(!e.length)return!0;for(let n=0;n<e.length;n++)if(A(t,e[n]))return!0;return!1}const F="undefined"!=typeof window&&"undefined"!=typeof document,k=t=>Uint8Array.from(atob(t),(t=>t.charCodeAt(0)));return t.GrowthBook=class{constructor(t){this.t=this.context=t=t||{},this.i=null,this.o=new Set,this.u={},this.debug=!1,this.h=new Set,this.l=[],this.p=0,this.ready=!1,this.g=new Map,this.v=new Map,this.$={},t.features&&(this.ready=!0),F&&t.enableDevMode&&(window._growthbook=this,document.dispatchEvent(new Event("gbloaded"))),t.clientKey&&this.A({},!0,!1)}async loadFeatures(t){await this.A(t,!0,!0),t&&t.autoRefresh&&function(t){const[e]=a(t),n=r.get(e)||new Set;n.add(t),r.set(e,n)}(this)}async refreshFeatures(t){await this.A(t,!1,!0)}getApiInfo(){return[(this.t.apiHost||"https://cdn.growthbook.io").replace(/\/*$/,""),this.t.clientKey||""]}async A(t,r,o){if(t=t||{},!this.t.clientKey)throw new Error("Missing clientKey");await async function(t,r,o,u,c){const h=await async function(t,r,o,u){const[c]=a(t),h=new Date;await async function(){if(!i){i=!0;try{if(n.localStorage){const t=await n.localStorage.getItem(e.cacheKey);if(t){const e=JSON.parse(t);e&&Array.isArray(e)&&e.forEach((t=>{let[e,n]=t;s.set(e,{...n,staleAt:new Date(n.staleAt)})}))}}}catch(t){}}}();const f=s.get(c);if(f&&!u&&(r||f.staleAt>h))return f.staleAt<h?d(t):w(t),f.data;{const e=await function(t,e){return new Promise((n=>{let r,i=!1;const s=t=>{i||(i=!0,r&&clearTimeout(r),n(t||null))};e&&(r=setTimeout((()=>s()),e)),t.then((t=>s(t))).catch((()=>s()))}))}(d(t),o);return e}}(t,u,r,o);c&&h&&await l(t,h)}(this,t.timeout,t.skipCache||this.t.enableDevMode,r,o)}m(){this.i&&this.i()}setFeatures(t){this.t.features=t,this.ready=!0,this.m()}async setEncryptedFeatures(t,e,n){if(e=e||this.t.decryptionKey||"",!(n=n||globalThis.crypto&&globalThis.crypto.subtle))throw new Error("No SubtleCrypto implementation found");try{const r=await n.importKey("raw",k(e),{name:"AES-CBC",length:128},!0,["encrypt","decrypt"]),[i,s]=t.split("."),o=await n.decrypt({name:"AES-CBC",iv:k(i)},r,k(s));this.setFeatures(JSON.parse((new TextDecoder).decode(o)))}catch(t){throw new Error("Failed to decrypt features")}}setAttributes(t){this.t.attributes=t,this.m()}setAttributeOverrides(t){this.$=t,this.m()}setForcedVariations(t){this.t.forcedVariations=t||{},this.m()}setForcedFeatures(t){this.v=t,this.m()}getAttributes(){return{...this.t.attributes,...this.$}}getFeatures(){return this.t.features||{}}subscribe(t){return this.h.add(t),()=>{this.h.delete(t)}}getAllResults(){return new Map(this.g)}destroy(){var t;this.h.clear(),this.g.clear(),this.o.clear(),this.u={},this.l=[],this.p&&clearTimeout(this.p),t=this,r.forEach((e=>e.delete(t))),F&&window._growthbook===this&&delete window._growthbook}setRenderer(t){this.i=t}forceVariation(t,e){this.t.forcedVariations=this.t.forcedVariations||{},this.t.forcedVariations[t]=e,this.m()}run(t){const e=this.O(t,null);return this.S(t,e),e}S(t,e){const n=t.key,r=this.g.get(n);r&&r.result.inExperiment===e.inExperiment&&r.result.variationId===e.variationId||(this.g.set(n,{experiment:t,result:e}),this.h.forEach((n=>{try{n(t,e)}catch(t){console.error(t)}})))}_(t,e){if("override"===e.source)return;const n=JSON.stringify(e.value);if(this.u[t]!==n){if(this.u[t]=n,this.t.onFeatureUsage)try{this.t.onFeatureUsage(t,e)}catch(t){}F&&window.fetch&&(this.l.push({key:t,on:e.on}),this.p||(this.p=window.setTimeout((()=>{this.p=0;const t=[...this.l];this.l=[],this.t.realtimeKey&&window.fetch("https://rt.growthbook.io/?key=".concat(this.t.realtimeKey,"&events=").concat(encodeURIComponent(JSON.stringify(t))),{cache:"no-cache",mode:"no-cors"}).catch((()=>{}))}),this.t.realtimeInterval||2e3)))}}T(t,e,n,r,i,s){const o={value:e,on:!!e,off:!e,source:n,ruleId:r||""};return i&&(o.experiment=i),s&&(o.experimentResult=s),this._(t,o),o}isOn(t){return this.evalFeature(t).on}isOff(t){return this.evalFeature(t).off}getFeatureValue(t,e){var n;return null!==(n=this.evalFeature(t).value)&&void 0!==n?n:e}feature(t){return this.evalFeature(t)}evalFeature(t){var e;if(this.v.has(t))return this.T(t,this.v.get(t),"override");if(!this.t.features||!this.t.features[t])return this.T(t,null,"unknownFeature");const n=this.t.features[t];if(n.rules)for(const e of n.rules){if(e.condition&&!this.F(e.condition))continue;if("force"in e){if("coverage"in e){const{hashValue:n}=this.k(e.hashAttribute);if(!n)continue;if(g(n+t)>e.coverage)continue}return this.T(t,e.force,"force",e.id)}if(!e.variations)continue;const n={variations:e.variations,key:e.key||t};"coverage"in e&&(n.coverage=e.coverage),e.weights&&(n.weights=e.weights),e.hashAttribute&&(n.hashAttribute=e.hashAttribute),e.namespace&&(n.namespace=e.namespace);const r=this.O(n,t);if(this.S(n,r),r.inExperiment)return this.T(t,r.value,"experiment",e.id,n,r)}return this.T(t,null!==(e=n.defaultValue)&&void 0!==e?e:null,"defaultValue")}F(t){return A(this.getAttributes(),t)}O(t,e){var n;const r=t.key,i=t.variations.length;if(i<2)return this.M(t,-1,!1,e);if(!1===this.t.enabled)return this.M(t,-1,!1,e);t=this.V(t);const s=function(t,e,n){if(!e)return null;const r=e.split("?")[1];if(!r)return null;const i=r.replace(/#.*/,"").split("&").map((t=>t.split("=",2))).filter((e=>{let[n]=e;return n===t})).map((t=>{let[,e]=t;return parseInt(e)}));return i.length>0&&i[0]>=0&&i[0]<n?i[0]:null}(r,this.C(),i);if(null!==s)return this.M(t,s,!1,e);if(this.t.forcedVariations&&r in this.t.forcedVariations)return this.M(t,this.t.forcedVariations[r],!1,e);if("draft"===t.status||!1===t.active)return this.M(t,-1,!1,e);const{hashValue:o}=this.k(t.hashAttribute);if(!o)return this.M(t,-1,!1,e);if(t.namespace&&!function(t,e){const n=g(t+"__"+e[0]);return n>=e[1]&&n<e[2]}(o,t.namespace))return this.M(t,-1,!1,e);if(t.include&&!function(t){try{return t()}catch(t){return console.error(t),!1}}(t.include))return this.M(t,-1,!1,e);if(t.condition&&!this.F(t.condition))return this.M(t,-1,!1,e);if(t.groups&&!this.N(t.groups))return this.M(t,-1,!1,e);if(t.url&&!this.j(t.url))return this.M(t,-1,!1,e);const u=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2?arguments[2]:void 0;e<0?e=0:e>1&&(e=1);const r=v(t);n=n||r,n.length!==t&&(n=r);const i=n.reduce(((t,e)=>e+t),0);(i<.99||i>1.01)&&(n=r);let s=0;return n.map((t=>{const n=s;return s+=t,[n,n+e*t]}))}(i,null!==(n=t.coverage)&&void 0!==n?n:1,t.weights),c=function(t,e){for(let n=0;n<e.length;n++)if(t>=e[n][0]&&t<e[n][1])return n;return-1}(g(o+r),u);if(c<0)return this.M(t,-1,!1,e);var h;if("force"in t)return this.M(t,null!==(h=t.force)&&void 0!==h?h:-1,!1,e);if(this.t.qaMode)return this.M(t,-1,!1,e);if("stopped"===t.status)return this.M(t,-1,!1,e);const a=this.M(t,c,!0,e);return this.J(t,a),a}log(t,e){this.debug&&(this.t.log?this.t.log(t,e):console.log(t,e))}J(t,e){if(!this.t.trackingCallback)return;const n=e.hashAttribute+e.hashValue+t.key+e.variationId;if(!this.o.has(n)){this.o.add(n);try{this.t.trackingCallback(t,e)}catch(t){console.error(t)}}}V(t){const e=t.key,n=this.t.overrides;return n&&n[e]&&"string"==typeof(t=Object.assign({},t,n[e])).url&&(t.url=function(t){try{const e=t.replace(/([^\\])\//g,"$1\\/");return new RegExp(e)}catch(t){return void console.error(t)}}(t.url)),t}k(t){const e=t||"id";let n="";return this.$[e]?n=this.$[e]:this.t.attributes?n=this.t.attributes[e]||"":this.t.user&&(n=this.t.user[e]||""),{hashAttribute:e,hashValue:n}}M(t,e,n,r){let i=!0;(e<0||e>=t.variations.length)&&(e=0,i=!1);const{hashAttribute:s,hashValue:o}=this.k(t.hashAttribute);return{featureId:r,inExperiment:i,hashUsed:n,variationId:e,value:t.variations[e],hashAttribute:s,hashValue:o}}C(){return this.t.url||(F?window.location.href:"")}j(t){const e=this.C();if(!e)return!1;const n=e.replace(/^https?:\/\//,"").replace(/^[^/]*\//,"/");return!!t.test(e)||!!t.test(n)}N(t){const e=this.t.groups||{};for(let n=0;n<t.length;n++)if(e[t[n]])return!0;return!1}},t.clearCache=async function(){s.clear(),o.clear(),p(),i=!1,await h()},t.configureCache=function(t){Object.assign(e,t),e.backgroundSync||p()},t.setPolyfills=function(t){Object.assign(n,t)},Object.defineProperty(t,"I",{value:!0}),t}({});
//# sourceMappingURL=index.min.js.map
