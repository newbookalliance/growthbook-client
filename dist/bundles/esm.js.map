{"version":3,"file":"esm.js","sources":["../../src/feature-repository.ts","../../src/util.ts","../../src/mongrule.ts","../../src/GrowthBook.ts"],"sourcesContent":["import {\n  ApiHost,\n  CacheSettings,\n  ClientKey,\n  FeatureApiResponse,\n  Polyfills,\n  RepositoryKey,\n} from \"./types/growthbook\";\nimport type { GrowthBook } from \".\";\n\ntype CacheEntry = {\n  data: FeatureApiResponse;\n  version: string;\n  staleAt: Date;\n};\ntype ScopedChannel = {\n  src: EventSource;\n  cb: (event: MessageEvent<string>) => void;\n  errors: number;\n};\n\n// Config settings\nconst cacheSettings: CacheSettings = {\n  // Consider a fetch stale after 1 minute\n  staleTTL: 1000 * 60,\n  cacheKey: \"gbFeaturesCache\",\n  backgroundSync: true,\n};\nconst polyfills: Polyfills = {\n  fetch: globalThis.fetch ? globalThis.fetch.bind(globalThis) : undefined,\n  SubtleCrypto: globalThis.crypto ? globalThis.crypto.subtle : undefined,\n  EventSource: globalThis.EventSource,\n};\ntry {\n  if (globalThis.localStorage) {\n    polyfills.localStorage = globalThis.localStorage;\n  }\n} catch (e) {\n  // Ignore localStorage errors\n}\n\n// Global state\nconst subscribedInstances: Map<RepositoryKey, Set<GrowthBook>> = new Map();\nlet cacheInitialized = false;\nconst cache: Map<RepositoryKey, CacheEntry> = new Map();\nconst activeFetches: Map<\n  RepositoryKey,\n  Promise<FeatureApiResponse>\n> = new Map();\nconst streams: Map<RepositoryKey, ScopedChannel> = new Map();\nconst supportsSSE: Set<RepositoryKey> = new Set();\n\n// Public functions\nexport function setPolyfills(overrides: Partial<Polyfills>): void {\n  Object.assign(polyfills, overrides);\n}\nexport function configureCache(overrides: Partial<CacheSettings>): void {\n  Object.assign(cacheSettings, overrides);\n  if (!cacheSettings.backgroundSync) {\n    clearAutoRefresh();\n  }\n}\n\nexport async function clearCache(): Promise<void> {\n  cache.clear();\n  activeFetches.clear();\n  clearAutoRefresh();\n  cacheInitialized = false;\n  await updatePersistentCache();\n}\n\nexport async function refreshFeatures(\n  instance: GrowthBook,\n  timeout?: number,\n  skipCache?: boolean,\n  allowStale?: boolean,\n  updateInstance?: boolean\n): Promise<void> {\n  const data = await fetchFeaturesWithCache(\n    instance,\n    allowStale,\n    timeout,\n    skipCache\n  );\n  updateInstance && data && (await setFeaturesOnInstance(instance, data));\n}\n\n// Subscribe a GrowthBook instance to feature changes\nexport function subscribe(instance: GrowthBook): void {\n  const [key] = getKey(instance);\n  const subs = subscribedInstances.get(key) || new Set();\n  subs.add(instance);\n  subscribedInstances.set(key, subs);\n}\nexport function unsubscribe(instance: GrowthBook): void {\n  subscribedInstances.forEach((s) => s.delete(instance));\n}\n\n// Private functions\nasync function updatePersistentCache() {\n  try {\n    if (!polyfills.localStorage) return;\n    await polyfills.localStorage.setItem(\n      cacheSettings.cacheKey,\n      JSON.stringify(Array.from(cache.entries()))\n    );\n  } catch (e) {\n    // Ignore localStorage errors\n  }\n}\n\nasync function fetchFeaturesWithCache(\n  instance: GrowthBook,\n  allowStale?: boolean,\n  timeout?: number,\n  skipCache?: boolean\n): Promise<FeatureApiResponse | null> {\n  const [key] = getKey(instance);\n  const now = new Date();\n  await initializeCache();\n  const existing = cache.get(key);\n  if (existing && !skipCache && (allowStale || existing.staleAt > now)) {\n    // Reload features in the backgroud if stale\n    if (existing.staleAt < now) {\n      fetchFeatures(instance);\n    }\n    // Otherwise, if we don't need to refresh now, start a background sync\n    else {\n      startAutoRefresh(instance);\n    }\n    return existing.data;\n  } else {\n    const data = await promiseTimeout(fetchFeatures(instance), timeout);\n    return data;\n  }\n}\n\nfunction getKey(instance: GrowthBook): [RepositoryKey, ApiHost, ClientKey] {\n  const [apiHost, clientKey] = instance.getApiInfo();\n  return [`${apiHost}||${clientKey}`, apiHost, clientKey];\n}\n\n// Guarantee the promise always resolves within {timeout} ms\n// Resolved value will be `null` when there's an error or it takes too long\n// Note: The promise will continue running in the background, even if the timeout is hit\nfunction promiseTimeout<T>(\n  promise: Promise<T>,\n  timeout?: number\n): Promise<T | null> {\n  return new Promise((resolve) => {\n    let resolved = false;\n    let timer: unknown;\n    const finish = (data?: T) => {\n      if (resolved) return;\n      resolved = true;\n      timer && clearTimeout(timer as NodeJS.Timer);\n      resolve(data || null);\n    };\n\n    if (timeout) {\n      timer = setTimeout(() => finish(), timeout);\n    }\n\n    promise.then((data) => finish(data)).catch(() => finish());\n  });\n}\n\n// Populate cache from localStorage (if available)\nasync function initializeCache(): Promise<void> {\n  if (cacheInitialized) return;\n  cacheInitialized = true;\n  try {\n    if (polyfills.localStorage) {\n      const value = await polyfills.localStorage.getItem(\n        cacheSettings.cacheKey\n      );\n      if (value) {\n        const parsed: [RepositoryKey, CacheEntry][] = JSON.parse(value);\n        if (parsed && Array.isArray(parsed)) {\n          parsed.forEach(([key, data]) => {\n            cache.set(key, {\n              ...data,\n              staleAt: new Date(data.staleAt),\n            });\n          });\n        }\n      }\n    }\n  } catch (e) {\n    // Ignore localStorage errors\n  }\n}\n\n// Called whenever new features are fetched from the API\nfunction onNewFeatureData(key: RepositoryKey, data: FeatureApiResponse): void {\n  // If contents haven't changed, ignore the update, extend the stale TTL\n  const version = data.dateUpdated || \"\";\n  const staleAt = new Date(Date.now() + cacheSettings.staleTTL);\n  const existing = cache.get(key);\n  if (existing && version && existing.version === version) {\n    existing.staleAt = staleAt;\n    return;\n  }\n\n  // Update in-memory cache\n  cache.set(key, {\n    data,\n    version,\n    staleAt,\n  });\n  // Update local storage (don't await this, just update asynchronously)\n  updatePersistentCache();\n\n  // Update features for all subscribed GrowthBook instances\n  const instances = subscribedInstances.get(key);\n  instances &&\n    instances.forEach((instance) => setFeaturesOnInstance(instance, data));\n}\n\nasync function setFeaturesOnInstance(\n  instance: GrowthBook,\n  data: FeatureApiResponse\n): Promise<void> {\n  await (data.encryptedFeatures\n    ? instance.setEncryptedFeatures(\n        data.encryptedFeatures,\n        undefined,\n        polyfills.SubtleCrypto\n      )\n    : instance.setFeatures(data.features || instance.getFeatures()));\n}\n\nasync function fetchFeatures(\n  instance: GrowthBook\n): Promise<FeatureApiResponse> {\n  const [key, apiHost, clientKey] = getKey(instance);\n  const endpoint = apiHost + \"/api/features/\" + clientKey;\n\n  let promise = activeFetches.get(key);\n  if (!promise) {\n    promise = (polyfills.fetch as typeof globalThis.fetch)(endpoint)\n      // TODO: auto-retry if status code indicates a temporary error\n      .then((res) => {\n        if (res.headers.get(\"x-sse-support\") === \"enabled\") {\n          supportsSSE.add(key);\n        }\n        return res.json();\n      })\n      .then((data: FeatureApiResponse) => {\n        onNewFeatureData(key, data);\n        startAutoRefresh(instance);\n        activeFetches.delete(key);\n        return data;\n      })\n      .catch((e) => {\n        process.env.NODE_ENV !== \"production\" &&\n          instance.log(\"Error fetching features\", {\n            apiHost,\n            clientKey,\n            error: e ? e.message : null,\n          });\n        activeFetches.delete(key);\n        return Promise.resolve({});\n      });\n    activeFetches.set(key, promise);\n  }\n  return await promise;\n}\n\n// Watch a feature endpoint for changes\n// Will prefer SSE if enabled, otherwise fall back to cron\nfunction startAutoRefresh(instance: GrowthBook) {\n  const [key, apiHost, clientKey] = getKey(instance);\n  if (\n    cacheSettings.backgroundSync &&\n    supportsSSE.has(key) &&\n    polyfills.EventSource\n  ) {\n    if (streams.has(key)) return;\n    const channel: ScopedChannel = {\n      src: new polyfills.EventSource(`${apiHost}/sub/${clientKey}`),\n      cb: (event: MessageEvent<string>) => {\n        try {\n          const json: FeatureApiResponse = JSON.parse(event.data);\n          onNewFeatureData(key, json);\n          // Reset error count on success\n          channel.errors = 0;\n        } catch (e) {\n          process.env.NODE_ENV !== \"production\" &&\n            instance.log(\"SSE Error\", {\n              apiHost,\n              clientKey,\n              error: e ? (e as Error).message : null,\n            });\n          onSSEError(channel, key);\n        }\n      },\n      errors: 0,\n    };\n    streams.set(key, channel);\n    channel.src.addEventListener(\"features\", channel.cb);\n\n    channel.src.onerror = () => {\n      onSSEError(channel, key);\n    };\n  }\n}\n\nfunction onSSEError(channel: ScopedChannel, key: RepositoryKey) {\n  channel.errors++;\n  if (channel.errors > 3 || channel.src.readyState === 2) {\n    destroyChannel(channel, key);\n  }\n}\n\nfunction destroyChannel(channel: ScopedChannel, key: RepositoryKey) {\n  channel.src.onerror = null;\n  channel.src.close();\n  streams.delete(key);\n}\n\nfunction clearAutoRefresh() {\n  // Clear list of which keys are auto-updated\n  supportsSSE.clear();\n\n  // Stop listening for any SSE events\n  streams.forEach(destroyChannel);\n\n  // Remove all references to GrowthBook instances\n  subscribedInstances.clear();\n}\n","import { VariationRange } from \"./types/growthbook\";\n\nfunction hashFnv32a(str: string): number {\n  let hval = 0x811c9dc5;\n  const l = str.length;\n\n  for (let i = 0; i < l; i++) {\n    hval ^= str.charCodeAt(i);\n    hval +=\n      (hval << 1) + (hval << 4) + (hval << 7) + (hval << 8) + (hval << 24);\n  }\n  return hval >>> 0;\n}\n\nexport function hash(str: string): number {\n  return (hashFnv32a(str) % 1000) / 1000;\n}\n\nexport function getEqualWeights(n: number): number[] {\n  if (n <= 0) return [];\n  return new Array(n).fill(1 / n);\n}\n\nexport function inNamespace(\n  hashValue: string,\n  namespace: [string, number, number]\n): boolean {\n  const n = hash(hashValue + \"__\" + namespace[0]);\n  return n >= namespace[1] && n < namespace[2];\n}\n\nexport function chooseVariation(n: number, ranges: VariationRange[]): number {\n  for (let i = 0; i < ranges.length; i++) {\n    if (n >= ranges[i][0] && n < ranges[i][1]) {\n      return i;\n    }\n  }\n  return -1;\n}\n\nexport function getUrlRegExp(regexString: string): RegExp | undefined {\n  try {\n    const escaped = regexString.replace(/([^\\\\])\\//g, \"$1\\\\/\");\n    return new RegExp(escaped);\n  } catch (e) {\n    console.error(e);\n    return undefined;\n  }\n}\n\nexport function getBucketRanges(\n  numVariations: number,\n  coverage: number = 1,\n  weights?: number[]\n): VariationRange[] {\n  // Make sure coverage is within bounds\n  if (coverage < 0) {\n    if (process.env.NODE_ENV !== \"production\") {\n      console.error(\"Experiment.coverage must be greater than or equal to 0\");\n    }\n    coverage = 0;\n  } else if (coverage > 1) {\n    if (process.env.NODE_ENV !== \"production\") {\n      console.error(\"Experiment.coverage must be less than or equal to 1\");\n    }\n    coverage = 1;\n  }\n\n  // Default to equal weights if missing or invalid\n  const equal = getEqualWeights(numVariations);\n  weights = weights || equal;\n  if (weights.length !== numVariations) {\n    if (process.env.NODE_ENV !== \"production\") {\n      console.error(\n        \"Experiment.weights array must be the same length as Experiment.variations\"\n      );\n    }\n    weights = equal;\n  }\n\n  // If weights don't add up to 1 (or close to it), default to equal weights\n  const totalWeight = weights.reduce((w, sum) => sum + w, 0);\n  if (totalWeight < 0.99 || totalWeight > 1.01) {\n    if (process.env.NODE_ENV !== \"production\") {\n      console.error(\"Experiment.weights must add up to 1\");\n    }\n    weights = equal;\n  }\n\n  // Covert weights to ranges\n  let cumulative = 0;\n  return weights.map((w) => {\n    const start = cumulative;\n    cumulative += w;\n    return [start, start + coverage * w];\n  }) as VariationRange[];\n}\n\nexport function getQueryStringOverride(\n  id: string,\n  url: string,\n  numVariations: number\n) {\n  if (!url) {\n    return null;\n  }\n\n  const search = url.split(\"?\")[1];\n  if (!search) {\n    return null;\n  }\n\n  const match = search\n    .replace(/#.*/, \"\") // Get rid of anchor\n    .split(\"&\") // Split into key/value pairs\n    .map((kv) => kv.split(\"=\", 2))\n    .filter(([k]) => k === id) // Look for key that matches the experiment id\n    .map(([, v]) => parseInt(v)); // Parse the value into an integer\n\n  if (match.length > 0 && match[0] >= 0 && match[0] < numVariations)\n    return match[0];\n\n  return null;\n}\n\nexport function isIncluded(include: () => boolean) {\n  try {\n    return include();\n  } catch (e) {\n    console.error(e);\n    return false;\n  }\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\n\nimport {\n  ConditionInterface,\n  TestedObj,\n  ConditionValue,\n  Operator,\n  OperatorConditionValue,\n  VarType,\n} from \"./types/mongrule\";\n\nconst _regexCache: { [key: string]: RegExp } = {};\n\n// The top-level condition evaluation function\nexport function evalCondition(\n  obj: TestedObj,\n  condition: ConditionInterface\n): boolean {\n  // Recursive condition\n  if (\"$or\" in condition) {\n    return evalOr(obj, condition[\"$or\"] as ConditionInterface[]);\n  }\n  if (\"$nor\" in condition) {\n    return !evalOr(obj, condition[\"$nor\"] as ConditionInterface[]);\n  }\n  if (\"$and\" in condition) {\n    return evalAnd(obj, condition[\"$and\"] as ConditionInterface[]);\n  }\n  if (\"$not\" in condition) {\n    return !evalCondition(obj, condition[\"$not\"] as ConditionInterface);\n  }\n\n  // Condition is an object, keys are object paths, values are the condition for that path\n  for (const [k, v] of Object.entries(condition)) {\n    if (!evalConditionValue(v, getPath(obj, k))) return false;\n  }\n  return true;\n}\n\n// Return value at dot-separated path of an object\nfunction getPath(obj: TestedObj, path: string) {\n  const parts = path.split(\".\");\n  let current: any = obj;\n  for (let i = 0; i < parts.length; i++) {\n    if (current && typeof current === \"object\" && parts[i] in current) {\n      current = current[parts[i]];\n    } else {\n      return null;\n    }\n  }\n  return current;\n}\n\n// Transform a regex string into a real RegExp object\nfunction getRegex(regex: string): RegExp {\n  if (!_regexCache[regex]) {\n    _regexCache[regex] = new RegExp(regex.replace(/([^\\\\])\\//g, \"$1\\\\/\"));\n  }\n  return _regexCache[regex];\n}\n\n// Evaluate a single value against a condition\nfunction evalConditionValue(condition: ConditionValue, value: any) {\n  // Simple equality comparisons\n  if (typeof condition === \"string\") {\n    return value + \"\" === condition;\n  }\n  if (typeof condition === \"number\") {\n    return value * 1 === condition;\n  }\n  if (typeof condition === \"boolean\") {\n    return !!value === condition;\n  }\n  if (Array.isArray(condition) || !isOperatorObject(condition)) {\n    return JSON.stringify(value) === JSON.stringify(condition);\n  }\n\n  // This is a special operator condition and we should evaluate each one separately\n  for (const op in condition) {\n    if (\n      !evalOperatorCondition(\n        op as Operator,\n        value,\n        condition[op as keyof OperatorConditionValue]\n      )\n    ) {\n      return false;\n    }\n  }\n  return true;\n}\n\n// If the object has only keys that start with '$'\nfunction isOperatorObject(obj: any): boolean {\n  const keys = Object.keys(obj);\n  return (\n    keys.length > 0 && keys.filter((k) => k[0] === \"$\").length === keys.length\n  );\n}\n\n// Return the data type of a value\nfunction getType(v: any): VarType | \"unknown\" {\n  if (v === null) return \"null\";\n  if (Array.isArray(v)) return \"array\";\n  const t = typeof v;\n  if ([\"string\", \"number\", \"boolean\", \"object\", \"undefined\"].includes(t)) {\n    return t as VarType;\n  }\n  return \"unknown\";\n}\n\n// At least one element of actual must match the expected condition/value\nfunction elemMatch(actual: any, expected: any) {\n  if (!Array.isArray(actual)) return false;\n  const check = isOperatorObject(expected)\n    ? (v: any) => evalConditionValue(expected, v)\n    : (v: any) => evalCondition(v, expected);\n  for (let i = 0; i < actual.length; i++) {\n    if (actual[i] && check(actual[i])) {\n      return true;\n    }\n  }\n  return false;\n}\n\n// Evaluate a single operator condition\nfunction evalOperatorCondition(\n  operator: Operator,\n  actual: any,\n  expected: any\n): boolean {\n  switch (operator) {\n    case \"$eq\":\n      return actual === expected;\n    case \"$ne\":\n      return actual !== expected;\n    case \"$lt\":\n      return actual < expected;\n    case \"$lte\":\n      return actual <= expected;\n    case \"$gt\":\n      return actual > expected;\n    case \"$gte\":\n      return actual >= expected;\n    case \"$exists\":\n      return expected ? actual !== null : actual === null;\n    case \"$in\":\n      return expected.includes(actual);\n    case \"$nin\":\n      return !expected.includes(actual);\n    case \"$not\":\n      return !evalConditionValue(expected, actual);\n    case \"$size\":\n      if (!Array.isArray(actual)) return false;\n      return evalConditionValue(expected, actual.length);\n    case \"$elemMatch\":\n      return elemMatch(actual, expected);\n    case \"$all\":\n      if (!Array.isArray(actual)) return false;\n      for (let i = 0; i < expected.length; i++) {\n        let passed = false;\n        for (let j = 0; j < actual.length; j++) {\n          if (evalConditionValue(expected[i], actual[j])) {\n            passed = true;\n            break;\n          }\n        }\n        if (!passed) return false;\n      }\n      return true;\n    case \"$regex\":\n      try {\n        return getRegex(expected).test(actual);\n      } catch (e) {\n        return false;\n      }\n    case \"$type\":\n      return getType(actual) === expected;\n    default:\n      console.error(\"Unknown operator: \" + operator);\n      return false;\n  }\n}\n\n// Recursive $or rule\nfunction evalOr(obj: TestedObj, conditions: ConditionInterface[]): boolean {\n  if (!conditions.length) return true;\n  for (let i = 0; i < conditions.length; i++) {\n    if (evalCondition(obj, conditions[i])) {\n      return true;\n    }\n  }\n  return false;\n}\n\n// Recursive $and rule\nfunction evalAnd(obj: TestedObj, conditions: ConditionInterface[]): boolean {\n  for (let i = 0; i < conditions.length; i++) {\n    if (!evalCondition(obj, conditions[i])) {\n      return false;\n    }\n  }\n  return true;\n}\n","import type {\n  Context,\n  Experiment,\n  FeatureResult,\n  Result,\n  SubscriptionFunction,\n  FeatureDefinition,\n  FeatureResultSource,\n  Attributes,\n  JSONValue,\n  WidenPrimitives,\n  RealtimeUsageData,\n  LoadFeaturesOptions,\n  RefreshFeaturesOptions,\n  ApiHost,\n  ClientKey,\n} from \"./types/growthbook\";\nimport type { ConditionInterface } from \"./types/mongrule\";\nimport {\n  getUrlRegExp,\n  isIncluded,\n  getBucketRanges,\n  hash,\n  chooseVariation,\n  getQueryStringOverride,\n  inNamespace,\n} from \"./util\";\nimport { evalCondition } from \"./mongrule\";\nimport { refreshFeatures, subscribe, unsubscribe } from \"./feature-repository\";\n\nconst isBrowser =\n  typeof window !== \"undefined\" && typeof document !== \"undefined\";\n\nconst base64ToBuf = (b: string) =>\n  Uint8Array.from(atob(b), (c) => c.charCodeAt(0));\n\nexport class GrowthBook {\n  // context is technically private, but some tools depend on it so we can't mangle the name\n  // _ctx below is a clone of this property that we use internally\n  private context: Context;\n  public debug: boolean;\n  public ready: boolean;\n\n  // Properties and methods that start with \"_\" are mangled by Terser (saves ~150 bytes)\n  private _ctx: Context;\n  private _renderer: null | (() => void);\n  private _trackedExperiments: Set<unknown>;\n  private _trackedFeatures: Record<string, string>;\n  private _subscriptions: Set<SubscriptionFunction>;\n  private _rtQueue: RealtimeUsageData[];\n  private _rtTimer: number;\n  private _assigned: Map<\n    string,\n    {\n      // eslint-disable-next-line\n      experiment: Experiment<any>;\n      // eslint-disable-next-line\n      result: Result<any>;\n    }\n  >;\n  // eslint-disable-next-line\n  private _forcedFeatureValues: Map<string, any>;\n  private _attributeOverrides: Attributes;\n\n  constructor(context?: Context) {\n    context = context || {};\n    // These properties are all initialized in the constructor instead of above\n    // This saves ~80 bytes in the final output\n    this._ctx = this.context = context;\n    this._renderer = null;\n    this._trackedExperiments = new Set();\n    this._trackedFeatures = {};\n    this.debug = false;\n    this._subscriptions = new Set();\n    this._rtQueue = [];\n    this._rtTimer = 0;\n    this.ready = false;\n    this._assigned = new Map();\n    this._forcedFeatureValues = new Map();\n    this._attributeOverrides = {};\n\n    if (context.features) {\n      this.ready = true;\n    }\n\n    if (isBrowser && context.enableDevMode) {\n      window._growthbook = this;\n      document.dispatchEvent(new Event(\"gbloaded\"));\n    }\n\n    if (context.clientKey) {\n      this._refresh({}, true, false);\n    }\n  }\n\n  public async loadFeatures(options?: LoadFeaturesOptions): Promise<void> {\n    await this._refresh(options, true, true);\n    if (options && options.autoRefresh) {\n      subscribe(this);\n    }\n  }\n\n  public async refreshFeatures(\n    options?: RefreshFeaturesOptions\n  ): Promise<void> {\n    await this._refresh(options, false, true);\n  }\n\n  public getApiInfo(): [ApiHost, ClientKey] {\n    return [\n      (this._ctx.apiHost || \"https://cdn.growthbook.io\").replace(/\\/*$/, \"\"),\n      this._ctx.clientKey || \"\",\n    ];\n  }\n\n  private async _refresh(\n    options?: RefreshFeaturesOptions,\n    allowStale?: boolean,\n    updateInstance?: boolean\n  ) {\n    options = options || {};\n    if (!this._ctx.clientKey) {\n      throw new Error(\"Missing clientKey\");\n    }\n    await refreshFeatures(\n      this,\n      options.timeout,\n      options.skipCache || this._ctx.enableDevMode,\n      allowStale,\n      updateInstance\n    );\n  }\n\n  private _render() {\n    if (this._renderer) {\n      this._renderer();\n    }\n  }\n\n  public setFeatures(features: Record<string, FeatureDefinition>) {\n    this._ctx.features = features;\n    this.ready = true;\n    this._render();\n  }\n\n  public async setEncryptedFeatures(\n    encryptedString: string,\n    decryptionKey?: string,\n    subtle?: SubtleCrypto\n  ): Promise<void> {\n    decryptionKey = decryptionKey || this._ctx.decryptionKey || \"\";\n    subtle = subtle || (globalThis.crypto && globalThis.crypto.subtle);\n    if (!subtle) {\n      throw new Error(\"No SubtleCrypto implementation found\");\n    }\n    try {\n      const key = await subtle.importKey(\n        \"raw\",\n        base64ToBuf(decryptionKey),\n        { name: \"AES-CBC\", length: 128 },\n        true,\n        [\"encrypt\", \"decrypt\"]\n      );\n      const [iv, cipherText] = encryptedString.split(\".\");\n      const plainTextBuffer = await subtle.decrypt(\n        { name: \"AES-CBC\", iv: base64ToBuf(iv) },\n        key,\n        base64ToBuf(cipherText)\n      );\n\n      this.setFeatures(JSON.parse(new TextDecoder().decode(plainTextBuffer)));\n    } catch (e) {\n      throw new Error(\"Failed to decrypt features\");\n    }\n  }\n\n  public setAttributes(attributes: Attributes) {\n    this._ctx.attributes = attributes;\n    this._render();\n  }\n\n  public setAttributeOverrides(overrides: Attributes) {\n    this._attributeOverrides = overrides;\n    this._render();\n  }\n  public setForcedVariations(vars: Record<string, number>) {\n    this._ctx.forcedVariations = vars || {};\n    this._render();\n  }\n  // eslint-disable-next-line\n  public setForcedFeatures(map: Map<string, any>) {\n    this._forcedFeatureValues = map;\n    this._render();\n  }\n\n  public getAttributes() {\n    return { ...this._ctx.attributes, ...this._attributeOverrides };\n  }\n\n  public getFeatures() {\n    return this._ctx.features || {};\n  }\n\n  public subscribe(cb: SubscriptionFunction): () => void {\n    this._subscriptions.add(cb);\n\n    return () => {\n      this._subscriptions.delete(cb);\n    };\n  }\n\n  public getAllResults() {\n    return new Map(this._assigned);\n  }\n\n  public destroy() {\n    // Release references to save memory\n    this._subscriptions.clear();\n    this._assigned.clear();\n    this._trackedExperiments.clear();\n    this._trackedFeatures = {};\n    this._rtQueue = [];\n    if (this._rtTimer) {\n      clearTimeout(this._rtTimer);\n    }\n    unsubscribe(this);\n\n    if (isBrowser && window._growthbook === this) {\n      delete window._growthbook;\n    }\n  }\n\n  public setRenderer(renderer: () => void) {\n    this._renderer = renderer;\n  }\n\n  public forceVariation(key: string, variation: number) {\n    this._ctx.forcedVariations = this._ctx.forcedVariations || {};\n    this._ctx.forcedVariations[key] = variation;\n    this._render();\n  }\n\n  public run<T>(experiment: Experiment<T>): Result<T> {\n    const result = this._run(experiment, null);\n    this._fireSubscriptions(experiment, result);\n    return result;\n  }\n\n  private _fireSubscriptions<T>(experiment: Experiment<T>, result: Result<T>) {\n    const key = experiment.key;\n\n    // If assigned variation has changed, fire subscriptions\n    const prev = this._assigned.get(key);\n    // TODO: what if the experiment definition has changed?\n    if (\n      !prev ||\n      prev.result.inExperiment !== result.inExperiment ||\n      prev.result.variationId !== result.variationId\n    ) {\n      this._assigned.set(key, { experiment, result });\n      this._subscriptions.forEach((cb) => {\n        try {\n          cb(experiment, result);\n        } catch (e) {\n          console.error(e);\n        }\n      });\n    }\n  }\n\n  private _trackFeatureUsage(key: string, res: FeatureResult): void {\n    // Don't track feature usage that was forced via an override\n    if (res.source === \"override\") return;\n\n    // Only track a feature once, unless the assigned value changed\n    const stringifiedValue = JSON.stringify(res.value);\n    if (this._trackedFeatures[key] === stringifiedValue) return;\n    this._trackedFeatures[key] = stringifiedValue;\n\n    // Fire user-supplied callback\n    if (this._ctx.onFeatureUsage) {\n      try {\n        this._ctx.onFeatureUsage(key, res);\n      } catch (e) {\n        // Ignore feature usage callback errors\n      }\n    }\n\n    // In browser environments, queue up feature usage to be tracked in batches\n    if (!isBrowser || !window.fetch) return;\n    this._rtQueue.push({\n      key,\n      on: res.on,\n    });\n    if (!this._rtTimer) {\n      this._rtTimer = window.setTimeout(() => {\n        // Reset the queue\n        this._rtTimer = 0;\n        const q = [...this._rtQueue];\n        this._rtQueue = [];\n\n        // Skip logging if a real-time usage key is not configured\n        if (!this._ctx.realtimeKey) return;\n\n        window\n          .fetch(\n            `https://rt.growthbook.io/?key=${\n              this._ctx.realtimeKey\n            }&events=${encodeURIComponent(JSON.stringify(q))}`,\n\n            {\n              cache: \"no-cache\",\n              mode: \"no-cors\",\n            }\n          )\n          .catch(() => {\n            // TODO: retry in case of network errors?\n          });\n      }, this._ctx.realtimeInterval || 2000);\n    }\n  }\n\n  private _getFeatureResult<T>(\n    key: string,\n    value: T,\n    source: FeatureResultSource,\n    ruleId?: string,\n    experiment?: Experiment<T>,\n    result?: Result<T>\n  ): FeatureResult<T> {\n    const ret: FeatureResult = {\n      value,\n      on: !!value,\n      off: !value,\n      source,\n      ruleId: ruleId || \"\",\n    };\n    if (experiment) ret.experiment = experiment;\n    if (result) ret.experimentResult = result;\n\n    // Track the usage of this feature in real-time\n    this._trackFeatureUsage(key, ret);\n\n    return ret;\n  }\n\n  public isOn(key: string): boolean {\n    return this.evalFeature(key).on;\n  }\n  public isOff(key: string): boolean {\n    return this.evalFeature(key).off;\n  }\n  public getFeatureValue<T extends JSONValue>(\n    key: string,\n    defaultValue: T\n  ): WidenPrimitives<T> {\n    return (\n      this.evalFeature<WidenPrimitives<T>>(key).value ??\n      (defaultValue as WidenPrimitives<T>)\n    );\n  }\n\n  // eslint-disable-next-line\n  public feature<T extends JSONValue = any>(\n    id: string\n  ): FeatureResult<T | null> {\n    return this.evalFeature(id);\n  }\n\n  // eslint-disable-next-line\n  public evalFeature<T extends JSONValue = any>(\n    id: string\n  ): FeatureResult<T | null> {\n    // Global override\n    if (this._forcedFeatureValues.has(id)) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Global override\", {\n          id,\n          value: this._forcedFeatureValues.get(id),\n        });\n      return this._getFeatureResult(\n        id,\n        this._forcedFeatureValues.get(id),\n        \"override\"\n      );\n    }\n\n    // Unknown feature id\n    if (!this._ctx.features || !this._ctx.features[id]) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Unknown feature\", { id });\n      return this._getFeatureResult(id, null, \"unknownFeature\");\n    }\n\n    // Get the feature\n    const feature: FeatureDefinition<T> = this._ctx.features[id];\n\n    // Loop through the rules\n    if (feature.rules) {\n      for (const rule of feature.rules) {\n        // If it's a conditional rule, skip if the condition doesn't pass\n        if (rule.condition && !this._conditionPasses(rule.condition)) {\n          process.env.NODE_ENV !== \"production\" &&\n            this.log(\"Skip rule because of condition\", {\n              id,\n              rule,\n            });\n          continue;\n        }\n        // Feature value is being forced\n        if (\"force\" in rule) {\n          // Skip if coverage is reduced and user not included\n          if (\"coverage\" in rule) {\n            const { hashValue } = this._getHashAttribute(rule.hashAttribute);\n            if (!hashValue) {\n              process.env.NODE_ENV !== \"production\" &&\n                this.log(\"Skip rule because of missing hashAttribute\", {\n                  id,\n                  rule,\n                });\n              continue;\n            }\n            const n = hash(hashValue + id);\n            if (n > (rule.coverage as number)) {\n              process.env.NODE_ENV !== \"production\" &&\n                this.log(\"Skip rule because of coverage\", {\n                  id,\n                  rule,\n                });\n              continue;\n            }\n          }\n\n          process.env.NODE_ENV !== \"production\" &&\n            this.log(\"Force value from rule\", {\n              id,\n              rule,\n            });\n\n          return this._getFeatureResult(id, rule.force as T, \"force\", rule.id);\n        }\n        if (!rule.variations) {\n          process.env.NODE_ENV !== \"production\" &&\n            this.log(\"Skip invalid rule\", {\n              id,\n              rule,\n            });\n\n          continue;\n        }\n        // For experiment rules, run an experiment\n        const exp: Experiment<T> = {\n          variations: rule.variations as [T, T, ...T[]],\n          key: rule.key || id,\n        };\n        if (\"coverage\" in rule) exp.coverage = rule.coverage;\n        if (rule.weights) exp.weights = rule.weights;\n        if (rule.hashAttribute) exp.hashAttribute = rule.hashAttribute;\n        if (rule.namespace) exp.namespace = rule.namespace;\n\n        // Only return a value if the user is part of the experiment\n        const res = this._run(exp, id);\n        this._fireSubscriptions(exp, res);\n        if (res.inExperiment) {\n          return this._getFeatureResult(\n            id,\n            res.value,\n            \"experiment\",\n            rule.id,\n            exp,\n            res\n          );\n        }\n      }\n    }\n\n    process.env.NODE_ENV !== \"production\" &&\n      this.log(\"Use default value\", {\n        id,\n        value: feature.defaultValue ?? null,\n      });\n\n    // Fall back to using the default value\n    return this._getFeatureResult(\n      id,\n      feature.defaultValue ?? null,\n      \"defaultValue\"\n    );\n  }\n\n  private _conditionPasses(condition: ConditionInterface): boolean {\n    return evalCondition(this.getAttributes(), condition);\n  }\n\n  private _run<T>(\n    experiment: Experiment<T>,\n    featureId: string | null\n  ): Result<T> {\n    const key = experiment.key;\n    const numVariations = experiment.variations.length;\n\n    // 1. If experiment has less than 2 variations, return immediately\n    if (numVariations < 2) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Invalid experiment\", { id: key });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 2. If the context is disabled, return immediately\n    if (this._ctx.enabled === false) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Context disabled\", { id: key });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 2.5. Merge in experiment overrides from the context\n    experiment = this._mergeOverrides(experiment);\n\n    // 3. If a variation is forced from a querystring, return the forced variation\n    const qsOverride = getQueryStringOverride(\n      key,\n      this._getContextUrl(),\n      numVariations\n    );\n    if (qsOverride !== null) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Force via querystring\", {\n          id: key,\n          variation: qsOverride,\n        });\n      return this._getResult(experiment, qsOverride, false, featureId);\n    }\n\n    // 4. If a variation is forced in the context, return the forced variation\n    if (this._ctx.forcedVariations && key in this._ctx.forcedVariations) {\n      const variation = this._ctx.forcedVariations[key];\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Force via dev tools\", {\n          id: key,\n          variation,\n        });\n      return this._getResult(experiment, variation, false, featureId);\n    }\n\n    // 5. Exclude if a draft experiment or not active\n    if (experiment.status === \"draft\" || experiment.active === false) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because inactive\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 6. Get the hash attribute and return if empty\n    const { hashValue } = this._getHashAttribute(experiment.hashAttribute);\n    if (!hashValue) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because missing hashAttribute\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 7. Exclude if user not in experiment.namespace\n    if (experiment.namespace && !inNamespace(hashValue, experiment.namespace)) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because of namespace\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 7.5. Exclude if experiment.include returns false or throws\n    if (experiment.include && !isIncluded(experiment.include)) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because of include function\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 8. Exclude if condition is false\n    if (experiment.condition && !this._conditionPasses(experiment.condition)) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because of condition\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 8.1. Exclude if user is not in a required group\n    if (\n      experiment.groups &&\n      !this._hasGroupOverlap(experiment.groups as string[])\n    ) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because of groups\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 8.2. Exclude if not on a targeted url\n    if (experiment.url && !this._urlIsValid(experiment.url as RegExp)) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because of url\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 9. Get bucket ranges and choose variation\n    const ranges = getBucketRanges(\n      numVariations,\n      experiment.coverage ?? 1,\n      experiment.weights\n    );\n    const n = hash(hashValue + key);\n    const assigned = chooseVariation(n, ranges);\n\n    // 10. Return if not in experiment\n    if (assigned < 0) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because of coverage\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 11. Experiment has a forced variation\n    if (\"force\" in experiment) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Force variation\", {\n          id: key,\n          variation: experiment.force,\n        });\n      return this._getResult(\n        experiment,\n        experiment.force ?? -1,\n        false,\n        featureId\n      );\n    }\n\n    // 12. Exclude if in QA mode\n    if (this._ctx.qaMode) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because QA mode\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 12.5. Exclude if experiment is stopped\n    if (experiment.status === \"stopped\") {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because stopped\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 13. Build the result object\n    const result = this._getResult(experiment, assigned, true, featureId);\n\n    // 14. Fire the tracking callback\n    this._track(experiment, result);\n\n    // 15. Return the result\n    process.env.NODE_ENV !== \"production\" &&\n      this.log(\"In experiment\", {\n        id: key,\n        variation: result.variationId,\n      });\n    return result;\n  }\n\n  log(msg: string, ctx: Record<string, unknown>) {\n    if (!this.debug) return;\n    if (this._ctx.log) this._ctx.log(msg, ctx);\n    else console.log(msg, ctx);\n  }\n\n  private _track<T>(experiment: Experiment<T>, result: Result<T>) {\n    if (!this._ctx.trackingCallback) return;\n\n    const key = experiment.key;\n\n    // Make sure a tracking callback is only fired once per unique experiment\n    const k =\n      result.hashAttribute + result.hashValue + key + result.variationId;\n    if (this._trackedExperiments.has(k)) return;\n    this._trackedExperiments.add(k);\n\n    try {\n      this._ctx.trackingCallback(experiment, result);\n    } catch (e) {\n      console.error(e);\n    }\n  }\n\n  private _mergeOverrides<T>(experiment: Experiment<T>): Experiment<T> {\n    const key = experiment.key;\n    const o = this._ctx.overrides;\n    if (o && o[key]) {\n      experiment = Object.assign({}, experiment, o[key]);\n      if (typeof experiment.url === \"string\") {\n        experiment.url = getUrlRegExp(\n          // eslint-disable-next-line\n          experiment.url as any\n        );\n      }\n    }\n\n    return experiment;\n  }\n\n  private _getHashAttribute(attr?: string) {\n    const hashAttribute = attr || \"id\";\n\n    let hashValue = \"\";\n    if (this._attributeOverrides[hashAttribute]) {\n      hashValue = this._attributeOverrides[hashAttribute];\n    } else if (this._ctx.attributes) {\n      hashValue = this._ctx.attributes[hashAttribute] || \"\";\n    } else if (this._ctx.user) {\n      hashValue = this._ctx.user[hashAttribute] || \"\";\n    }\n\n    return { hashAttribute, hashValue };\n  }\n\n  private _getResult<T>(\n    experiment: Experiment<T>,\n    variationIndex: number,\n    hashUsed: boolean,\n    featureId: string | null\n  ): Result<T> {\n    let inExperiment = true;\n    // If assigned variation is not valid, use the baseline and mark the user as not in the experiment\n    if (variationIndex < 0 || variationIndex >= experiment.variations.length) {\n      variationIndex = 0;\n      inExperiment = false;\n    }\n\n    const { hashAttribute, hashValue } = this._getHashAttribute(\n      experiment.hashAttribute\n    );\n\n    return {\n      featureId,\n      inExperiment,\n      hashUsed,\n      variationId: variationIndex,\n      value: experiment.variations[variationIndex],\n      hashAttribute,\n      hashValue,\n    };\n  }\n\n  private _getContextUrl() {\n    return this._ctx.url || (isBrowser ? window.location.href : \"\");\n  }\n\n  private _urlIsValid(urlRegex: RegExp): boolean {\n    const url = this._getContextUrl();\n    if (!url) return false;\n\n    const pathOnly = url.replace(/^https?:\\/\\//, \"\").replace(/^[^/]*\\//, \"/\");\n\n    if (urlRegex.test(url)) return true;\n    if (urlRegex.test(pathOnly)) return true;\n    return false;\n  }\n\n  private _hasGroupOverlap(expGroups: string[]): boolean {\n    const groups = this._ctx.groups || {};\n    for (let i = 0; i < expGroups.length; i++) {\n      if (groups[expGroups[i]]) return true;\n    }\n    return false;\n  }\n}\n"],"names":["cacheSettings","staleTTL","cacheKey","backgroundSync","polyfills","fetch","globalThis","bind","undefined","SubtleCrypto","crypto","subtle","EventSource","localStorage","e","subscribedInstances","Map","cacheInitialized","cache","activeFetches","streams","supportsSSE","Set","setPolyfills","overrides","Object","assign","configureCache","clearAutoRefresh","clearCache","clear","updatePersistentCache","refreshFeatures","instance","timeout","skipCache","allowStale","updateInstance","data","fetchFeaturesWithCache","setFeaturesOnInstance","subscribe","key","getKey","subs","get","add","set","unsubscribe","forEach","s","delete","setItem","JSON","stringify","Array","from","entries","now","Date","initializeCache","existing","staleAt","fetchFeatures","startAutoRefresh","promiseTimeout","apiHost","clientKey","getApiInfo","promise","Promise","resolve","resolved","timer","finish","clearTimeout","setTimeout","then","catch","value","getItem","parsed","parse","isArray","onNewFeatureData","version","dateUpdated","instances","encryptedFeatures","setEncryptedFeatures","setFeatures","features","getFeatures","endpoint","res","headers","json","has","channel","src","cb","event","errors","onSSEError","addEventListener","onerror","readyState","destroyChannel","close","hashFnv32a","str","hval","l","length","i","charCodeAt","hash","getEqualWeights","n","fill","inNamespace","hashValue","namespace","chooseVariation","ranges","getUrlRegExp","regexString","escaped","replace","RegExp","console","error","getBucketRanges","numVariations","coverage","weights","equal","totalWeight","reduce","w","sum","cumulative","map","start","getQueryStringOverride","id","url","search","split","match","kv","filter","k","v","parseInt","isIncluded","include","_regexCache","evalCondition","obj","condition","evalOr","evalAnd","evalConditionValue","getPath","path","parts","current","getRegex","regex","isOperatorObject","op","evalOperatorCondition","keys","getType","t","includes","elemMatch","actual","expected","check","operator","passed","j","test","conditions","isBrowser","window","document","base64ToBuf","b","Uint8Array","atob","c","GrowthBook","constructor","context","_ctx","_renderer","_trackedExperiments","_trackedFeatures","debug","_subscriptions","_rtQueue","_rtTimer","ready","_assigned","_forcedFeatureValues","_attributeOverrides","enableDevMode","_growthbook","dispatchEvent","Event","_refresh","loadFeatures","options","autoRefresh","Error","_render","encryptedString","decryptionKey","importKey","name","iv","cipherText","plainTextBuffer","decrypt","TextDecoder","decode","setAttributes","attributes","setAttributeOverrides","setForcedVariations","vars","forcedVariations","setForcedFeatures","getAttributes","getAllResults","destroy","setRenderer","renderer","forceVariation","variation","run","experiment","result","_run","_fireSubscriptions","prev","inExperiment","variationId","_trackFeatureUsage","source","stringifiedValue","onFeatureUsage","push","on","q","realtimeKey","encodeURIComponent","mode","realtimeInterval","_getFeatureResult","ruleId","ret","off","experimentResult","isOn","evalFeature","isOff","getFeatureValue","defaultValue","feature","rules","rule","_conditionPasses","_getHashAttribute","hashAttribute","force","variations","exp","featureId","_getResult","enabled","_mergeOverrides","qsOverride","_getContextUrl","status","active","groups","_hasGroupOverlap","_urlIsValid","assigned","qaMode","_track","log","msg","ctx","trackingCallback","o","attr","user","variationIndex","hashUsed","location","href","urlRegex","pathOnly","expGroups"],"mappings":"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"}